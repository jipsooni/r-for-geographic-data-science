<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 Supervised machine learning | R for Geographic Data Science</title>
<meta name="author" content="Stefano De Sabbata">
<meta name="description" content="Stefano De Sabbata This work is licensed under the GNU General Public License v3.0. Contains public sector information licensed under the Open Government Licence v3.0.  9.1 Introduction The field...">
<meta name="generator" content="bookdown 0.23 with bs4_book()">
<meta property="og:title" content="Chapter 9 Supervised machine learning | R for Geographic Data Science">
<meta property="og:type" content="book">
<meta property="og:url" content="https://sdesabbata.github.io/r-for-geographic-data-science/supervised-machine-learning.html">
<meta property="og:image" content="https://sdesabbata.github.io/r-for-geographic-data-science/images/r-for-geographic-data-science-cover.png">
<meta property="og:description" content="Stefano De Sabbata This work is licensed under the GNU General Public License v3.0. Contains public sector information licensed under the Open Government Licence v3.0.  9.1 Introduction The field...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 9 Supervised machine learning | R for Geographic Data Science">
<meta name="twitter:description" content="Stefano De Sabbata This work is licensed under the GNU General Public License v3.0. Contains public sector information licensed under the Open Government Licence v3.0.  9.1 Introduction The field...">
<meta name="twitter:image" content="https://sdesabbata.github.io/r-for-geographic-data-science/images/r-for-geographic-data-science-cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.10/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Geographic Data Science</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li class="book-part">Getting started</li>
<li><a class="" href="introduction-to-r.html"><span class="header-section-number">1</span> Introduction to R</a></li>
<li><a class="" href="r-programming.html"><span class="header-section-number">2</span> R programming</a></li>
<li class="book-part">Data wrangling</li>
<li><a class="" href="selection-and-manipulation.html"><span class="header-section-number">3</span> Selection and manipulation</a></li>
<li><a class="" href="table-operations.html"><span class="header-section-number">4</span> Table operations</a></li>
<li><a class="" href="reproducibility-1.html"><span class="header-section-number">5</span> Reproducibility</a></li>
<li class="book-part">Data analysis</li>
<li><a class="" href="exploratory-data-analysis.html"><span class="header-section-number">6</span> Exploratory data analysis</a></li>
<li><a class="" href="comparing-data.html"><span class="header-section-number">7</span> Comparing data</a></li>
<li><a class="" href="regression-analysis.html"><span class="header-section-number">8</span> Regression analysis</a></li>
<li class="book-part">Machine learning</li>
<li><a class="active" href="supervised-machine-learning.html"><span class="header-section-number">9</span> Supervised machine learning</a></li>
<li><a class="" href="unsupervised-machine-learning.html"><span class="header-section-number">10</span> Unsupervised machine learning</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/sdesabbata/r-for-geographic-data-science">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="supervised-machine-learning" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> Supervised machine learning<a class="anchor" aria-label="anchor" href="#supervised-machine-learning"><i class="fas fa-link"></i></a>
</h1>
<p><em><a href="https://stefanodesabbata.com">Stefano De Sabbata</a></em></p>
<p><a href="https://github.com/sdesabbata/granolarr">This work</a> is licensed under the <a href="https://www.gnu.org/licenses/gpl-3.0.html">GNU General Public License v3.0</a>. Contains public sector information licensed under the <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence">Open Government Licence v3.0</a>.</p>
<div id="introduction-2" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-2"><i class="fas fa-link"></i></a>
</h2>
<p>The field of <strong>machine learning</strong> sits at the intersection of computer science and statistics, and it is a core component of data science. According to Mitchell (1997), <em>“the field of machine learning is concerned with the question of how to construct computer programs that automatically improve with experience.”</em></p>
<p>Machine learning approaches are divided into two main types.</p>
<ul>
<li>
<strong>Supervised</strong>:
<ul>
<li>training of a <em>“predictive”</em> model from data;</li>
<li>one (or more) attribute of the dataset is used to “predict” another attribute.</li>
</ul>
</li>
<li>
<strong>Unsupervised</strong>:
<ul>
<li>discovery of <em>descriptive</em> patterns in data;</li>
<li>commonly used in data mining.</li>
</ul>
</li>
</ul>
<p>Classification is one of the classic supervised machine learning tasks, where algorithms are used to learn (i.e., model) the relationship between a series of input values (a.k.a. predictors, independent variables) and output categorical values or labels (a.k.a. outcome, dependent variable). A model trained on a training dataset can learn the relationship between the input and the labels, and then be used to label new, unlabeled data.</p>
<div id="artificial-neural-networks" class="section level3" number="9.1.1">
<h3>
<span class="header-section-number">9.1.1</span> Artificial neural networks<a class="anchor" aria-label="anchor" href="#artificial-neural-networks"><i class="fas fa-link"></i></a>
</h3>
<p>Artificial neural networks (ANNs) are one of the most studied approaches in supervised machine learning, and the term actually defines a large set of different approaches. These model aims to simulate a simplistic version of a brain made of artificial neurons. Each artificial neuron combines a series of input values into one output values, using a series of weights (one per input value) and an activation function. The aim of the model is to learn an optimal set of weights that, once combined with the input values, generates the correct output value. The latter is also influenced by the activation function, which modulates the final result.</p>
<center>
<img src="images/artificial_neuron.png" style="width:50.0%">
</center>
<p>Each neuron is effectively a regression model. The input values are the predictors (or independent variables), the output is the outcome (or dependent variable), and the weights are the coefficients (see also previous practical on regression models). The selection of the activation function defines the regression model. As ANNs are commonly used for classification, one of the most common activation functions used is the sigmoid, thus rendering every single neuron a logistic regression.</p>
<p>An instance of an ANN is defined by its topology (number of layers and nodes), activation functions and the algorithm used to train the network. The selection of all those parameters renders the construction of ANNs a very complex task, and the quality of the result frequently relies on the experience of the data scientist.</p>
<ul>
<li>Number of layers
<ul>
<li>Single-layer network: one node of input variable one node per category of the output variable, effectively a logistic regression.</li>
<li>Multi-layer network: adds one hidden layer, which aims to capture hidden <em>“features”</em> of the data, as combinations of the input values, and use that for the final classification.</li>
<li>Deep neural networks: several hidden layers, each aiming to capture more and more complex <em>“features”</em> of the data.</li>
</ul>
</li>
<li>Number of nodes
<ul>
<li>The number of nodes needs to be selected for each one of the hidden layers.</li>
</ul>
</li>
</ul>
</div>
<div id="support-vector-machines" class="section level3" number="9.1.2">
<h3>
<span class="header-section-number">9.1.2</span> Support vector machines<a class="anchor" aria-label="anchor" href="#support-vector-machines"><i class="fas fa-link"></i></a>
</h3>
<p>Support vector machines (SVMs) are another very common approach to supervised classification. SVMs perform the classification task by partitioning the data space into regions separated by hyperplanes. For instance, in a bi-dimensional space, a hyperplane is a line, and the algorithm is designed to find the line that best separates two groups of data. Computationally, the process is not dissimilar to linear regression.</p>
</div>
<div id="confusion-matrices" class="section level3" number="9.1.3">
<h3>
<span class="header-section-number">9.1.3</span> Confusion matrices<a class="anchor" aria-label="anchor" href="#confusion-matrices"><i class="fas fa-link"></i></a>
</h3>
<p>Once a classification model has been created, the next step is validation. The latter can involve different approaches and procedures, but one of the most common and simple approaches is to split the data between a training and a testing set. The model is trained on the training set and then validated using the testing set. Both sets will contain both the input values (predictors) and the output values (outcome).</p>
<p>The model trained using the training set can be used to predict the values for the testing set. The outcome of the prediction can be compared to the actual categories in the testing dataset. A <strong>confusion matrix</strong> is a representation of the correspondence between actual values and predicted values in the testing dataset, including:</p>
<ul>
<li>true positive: correctly classified as the first (positive) class;</li>
<li>true negative: correctly classified as the second (negative) class;</li>
<li>false positive: incorrectly classified as the first (positive) class;</li>
<li>false negative: incorrectly classified as the second (negative) class.</li>
</ul>
<p>The number of true and false positive and negatives are used to calculate a number of performance measures. The simplest measures of performance are <em>accuracy</em> and <em>error rate</em>.</p>
<p><span class="math display">\[
accuracy = \frac{true\ positive + true\ negative}{total\ number\ of\ cases}
\]</span>
<span class="math display">\[
error\ rate = 1 - accuracy
\]</span></p>
<p>There are also a number of additional measures that can provide further insight into the quality of the prediction, such as <em>sensitivity</em> (true positive rate) and <em>specificity</em> (true negative rate). If the model has been created to predict a binary categorical variable, based on the definition above (the first category is positive, the second category is negative), sensitivity is a measure of quality in predicting the first category, and specificity is a measure of quality in predicting the second category.</p>
<p><span class="math display">\[
sensitivity = \frac{true\ positive}{true\ positive + false\ negative} = \frac{correct\ 1st}{all\ 1st}
\]</span></p>
<p><span class="math display">\[
specificity = \frac{true\ negative}{true\ negative + false\ positive} = \frac{correct\ 2nd}{all\ 2nd}
\]</span></p>
<p>Two further, similar measures are <em>precision</em> and <em>recall</em>. A model with high precision is a model that can be trusted to make a correct prediction when identifying an observation as being part of the first category. The formula for recall is the same used for sensitivity, but in this case, it has a different interpretation, derived from the computer science literature on search engines, where a model with high recall is able to correctly retrieve most items of the specified category. Note that both precision and recall are dependent on which one of two categories is defined as being the first.</p>
<p><span class="math display">\[
precision = \frac{true\ positive}{true\ positive + false\ positive} = \frac{correct\ 1st}{predicted\ as\ 1st}
\]</span></p>
<p><span class="math display">\[
recall = \frac{true\ positive}{true\ positive + false\ negative} = \frac{correct\ 1st}{all\ 1st}
\]</span>
Precision and recall can also be combined into a single measure of performance called <em>F-score</em> (a.k.a., <em>F-measure</em> or <em>F1</em>).</p>
<p><span class="math display">\[
F-score = \frac{2 \times precision \times recall}{precision + recall}
\]</span>
Finally, the <em>kappa statistic</em> (the most common being <a href="https://en.wikipedia.org/wiki/Cohen%27s_kappa">Cohen’s kappa</a>) is an additional measure of accuracy, which measures the agreement between prediction and actual values, while also accounting for the probability of correct prediction by chance.</p>
</div>
</div>
<div id="examples" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> Examples<a class="anchor" aria-label="anchor" href="#examples"><i class="fas fa-link"></i></a>
</h2>
<p>The two examples below explore the relation between some of the variables from the United Kingdom 2011 Census included among the 167 initial variables used to create the <a href="https://maps.cdrc.ac.uk/#/geodemographics/oac11/default/BTTTFFT/12/-1.1233/52.6454/">2011 Output Area Classification</a> (<a href="http://josis.net/index.php/josis/article/view/232/150">Gale <em>et al.</em>, 2016</a>) and the <a href="https://geoportal.statistics.gov.uk/datasets/rural-urban-classification-2011-of-output-areas-in-england-and-wales">Rural Urban Classification (2011) of Output Areas in England and Wales</a> created by the <a href="https://geoportal.statistics.gov.uk/">Office for National Statistics</a>. The various examples and models explore whether it is possible to learn the rural-urban distinction by using some of those census variables, in the Local Authority Districts (LADs) in Leicestershire (excluding the city of Leicester itself.</p>
<p>The code below uses the libraries <code>caret</code>, <code>e1071</code> and <code>neuralnet</code>. Please install them before continuing with the practical.</p>
<div class="sourceCode" id="cb285"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"caret"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"e1071"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"neuralnet"</span><span class="op">)</span></code></pre></div>
<div id="data" class="section level3" number="9.2.1">
<h3>
<span class="header-section-number">9.2.1</span> Data<a class="anchor" aria-label="anchor" href="#data"><i class="fas fa-link"></i></a>
</h3>
<p>The examples use the same data seen in previous practicals, but for the 7 LADs in Leicestershire outside the boundaries of the city of Leicester: Blaby, Charnwood, Harborough, Hinckley and Bosworth, Melton, North West Leicestershire, and Oadby and Wigston. Those data are loaded from the <code>2011_OAC_Raw_uVariables_Leicestershire.csv</code>. The second part of the code extracts the data of the Rural Urban Classification (2011) from the compressed file <code>RUC11_OA11_EW.zip</code>, loads the extracted data and finally deletes them.</p>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Libraries</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>

<span class="co"># 2011 OAC data for Leicestershire (excl. Leicester)</span>
<span class="va">liec_shire_2011OAC</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"2011_OAC_Raw_uVariables_Leicestershire.csv"</span><span class="op">)</span>

<span class="co"># Rural Urban Classification (2011)</span>
<span class="co"># &gt;&gt;&gt; Note that if you upload the file to RStudio Server</span>
<span class="co"># &gt;&gt;&gt; the file will be automatically unzipped</span>
<span class="co"># &gt;&gt;&gt; thus the unzip and unlink instrcutions are not necessary</span>
<span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span><span class="st">"RUC11_OA11_EW.zip"</span><span class="op">)</span>
<span class="va">ru_class_2011</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"RUC11_OA11_EW.csv"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span><span class="op">(</span><span class="st">"RUC11_OA11_EW.csv"</span><span class="op">)</span></code></pre></div>
<p>We can then join the two datasets and create a simplified, binary rural - urban classification, that is used in the examples below.</p>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">liec_shire_2011OAC_RU</span> <span class="op">&lt;-</span>
  <span class="va">liec_shire_2011OAC</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">ru_class_2011</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    rural_urban <span class="op">=</span> 
      <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html">fct_recode</a></span><span class="op">(</span>
        <span class="va">RUC11CD</span>,
        urban <span class="op">=</span> <span class="st">"C1"</span>,
        rural <span class="op">=</span> <span class="st">"D1"</span>,
        rural <span class="op">=</span> <span class="st">"E1"</span>,
        rural <span class="op">=</span> <span class="st">"F1"</span>
      <span class="op">)</span> <span class="op">%&gt;%</span> 
      <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rural"</span>, <span class="st">"urban"</span><span class="op">)</span>
      <span class="op">)</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="logistic-regression" class="section level3" number="9.2.2">
<h3>
<span class="header-section-number">9.2.2</span> Logistic regression<a class="anchor" aria-label="anchor" href="#logistic-regression"><i class="fas fa-link"></i></a>
</h3>
<p>Can we predict whether an Output Area (OA) is urban or rural, solely based on its population density?</p>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">liec_shire_2011OAC_RU</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">u006</span>, 
      y <span class="op">=</span> <span class="va">rural_urban</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>
      color <span class="op">=</span> <span class="va">rural_urban</span>,
      shape <span class="op">=</span> <span class="va">rural_urban</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"deepskyblue2"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="400_SupervisedLearning_files/figure-html/unnamed-chunk-6-1.png" width="576"></div>
<p>The two patters in the plot above seem quite close even when plotted using a logarithmically transformed x-axis. As a first step, we can extract from the dataset only the data we need, and create a logarithmic transformation of the population density value. To be able to perform a simple validatin our model, we can divide that data in a training (80% of the dataset) and a testing set (20% of the dataset).</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Data for logit model</span>
<span class="va">ru_logit_data</span> <span class="op">&lt;-</span>
  <span class="va">liec_shire_2011OAC_RU</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">OA11CD</span>, <span class="va">u006</span>, <span class="va">rural_urban</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    density_log <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">u006</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># Training set</span>
<span class="va">ru_logit_data_trainig</span> <span class="op">&lt;-</span>
  <span class="va">ru_logit_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">slice_sample</span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>

<span class="co"># Testing set</span>
<span class="va">ru_logit_data_testing</span> <span class="op">&lt;-</span> 
  <span class="va">ru_logit_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">anti_join</span><span class="op">(</span><span class="va">ru_logit_data_trainig</span><span class="op">)</span></code></pre></div>
<p>We can then compute the logit model using the <code><a href="https://rdrr.io/r/stats/glm.html">stats::glm</a></code> function and specifying <code><a href="https://rdrr.io/r/stats/family.html">binomial()</a></code> as <code>family</code>. The summary of the model highlights how the model is significant, but <code>Residual deviance</code> is fairly close to the <code>Null deviance</code> (null model), which is not a good sign.</p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ru_logit_model</span> <span class="op">&lt;-</span> 
  <span class="va">ru_logit_data_trainig</span> <span class="op">%$%</span>
  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>
    <span class="va">rural_urban</span> <span class="op">~</span> 
      <span class="va">density_log</span>, 
    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">ru_logit_model</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = rural_urban ~ density_log, family = binomial())
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.1703  -0.6166   0.5383   0.6639   2.0452  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.26129    0.12677   -9.95   &lt;2e-16 ***
## density_log  1.78802    0.09757   18.33   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2084.0  on 1667  degrees of freedom
## Residual deviance: 1616.9  on 1666  degrees of freedom
## AIC: 1620.9
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>As per other regression models, it would be necessary to test the assumptions of the logit model and the overall distribution of the residuals. However, as this model only has one predictor, we will confine our performance analysis to simple validation.</p>
<p>We can test the performance of the model through a validation exercise, using the testing dataset. Finally, we can compare the results of the prediction with the original data using a confusion matrix.</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ru_logit_prediction</span> <span class="op">&lt;-</span> 
  <span class="va">ru_logit_model</span> <span class="op">%&gt;%</span>
  <span class="co"># Use model to predict values</span>
  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
    <span class="va">ru_logit_data_testing</span>, 
    type <span class="op">=</span> <span class="st">"response"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">ru_logit_data_testing</span> <span class="op">&lt;-</span> 
  <span class="va">ru_logit_data_testing</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>
    <span class="co"># Add column with predicted class</span>
    logit_predicted_ru <span class="op">=</span> 
      <span class="co"># Values below 0.5 indicate first factor level (rural)</span>
      <span class="co"># Values above 0.5 indicate second factor level (ruban)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span>
        <span class="va">ru_logit_prediction</span> <span class="op">&lt;=</span> <span class="fl">0.5</span>,
        <span class="st">"rural"</span>, <span class="co"># first factor level</span>
        <span class="st">"urban"</span>  <span class="co"># second factor level</span>
      <span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
      <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rural"</span>, <span class="st">"urban"</span><span class="op">)</span>
      <span class="op">)</span>
  <span class="op">)</span>

<span class="co"># Load library for confusion matrix</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span>

<span class="co"># Confusion matrix</span>
<span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>
  <span class="va">ru_logit_data_testing</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">logit_predicted_ru</span><span class="op">)</span>,
  <span class="va">ru_logit_data_testing</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">rural_urban</span><span class="op">)</span>,
  mode <span class="op">=</span> <span class="st">"everything"</span>
<span class="op">)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction rural urban
##      rural    58    23
##      urban    59   277
##                                           
##                Accuracy : 0.8034          
##                  95% CI : (0.7619, 0.8404)
##     No Information Rate : 0.7194          
##     P-Value [Acc &gt; NIR] : 5.082e-05       
##                                           
##                   Kappa : 0.4625          
##                                           
##  Mcnemar's Test P-Value : 0.000111        
##                                           
##             Sensitivity : 0.4957          
##             Specificity : 0.9233          
##          Pos Pred Value : 0.7160          
##          Neg Pred Value : 0.8244          
##               Precision : 0.7160          
##                  Recall : 0.4957          
##                      F1 : 0.5859          
##              Prevalence : 0.2806          
##          Detection Rate : 0.1391          
##    Detection Prevalence : 0.1942          
##       Balanced Accuracy : 0.7095          
##                                           
##        'Positive' Class : rural           
## </code></pre>
</div>
<div id="support-vector-machines-1" class="section level3" number="9.2.3">
<h3>
<span class="header-section-number">9.2.3</span> Support vector machines<a class="anchor" aria-label="anchor" href="#support-vector-machines-1"><i class="fas fa-link"></i></a>
</h3>
<p>To showcase the use of SVMs, the example below expands on the one above by building a model for urban - rural classification that uses total population and area (logarithmically transformed) as two separate input values, rather than combined as population density. The aim of the SVM is then to find a line that maximises the margin between the two groups shown in the plot below.</p>
<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">liec_shire_2011OAC_RU</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">u006</span>, 
      y <span class="op">=</span> <span class="va">Total_Population</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>
      color <span class="op">=</span> <span class="va">rural_urban</span>,
      shape <span class="op">=</span> <span class="va">rural_urban</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"deepskyblue2"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="400_SupervisedLearning_files/figure-html/unnamed-chunk-10-1.png" width="576"></div>
<p>The plot illustrates how the two variables are skewed (note that the axes are logarithmically transformed) and that the two groups are not linearly separable. We can thus follow a procedure similar to the one seen above: extract the necessary data; split the data between training and testing for validation; build the model; predict the values for the testing set and interpret the confusion matrix.</p>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Data for SVM model</span>
<span class="va">ru_svm_data</span> <span class="op">&lt;-</span>
  <span class="va">liec_shire_2011OAC_RU</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">OA11CD</span>, <span class="va">Total_Population</span>, <span class="va">u006</span>, <span class="va">rural_urban</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    area_log <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">u006</span><span class="op">)</span>,
    population_log <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">Total_Population</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># Training set</span>
<span class="va">ru_svm_data_trainig</span> <span class="op">&lt;-</span>
  <span class="va">ru_svm_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">slice_sample</span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>

<span class="co"># Testing set</span>
<span class="va">ru_svm_data_testing</span> <span class="op">&lt;-</span> 
  <span class="va">ru_svm_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">anti_join</span><span class="op">(</span><span class="va">ru_svm_data_trainig</span><span class="op">)</span>

<span class="co"># Load library for svm function</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">e1071</span><span class="op">)</span>

<span class="co"># Build the model</span>
<span class="va">ru_svm_model</span> <span class="op">&lt;-</span> 
  <span class="va">ru_svm_data_trainig</span> <span class="op">%$%</span>
  <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span><span class="op">(</span>
    <span class="va">rural_urban</span> <span class="op">~</span> 
      <span class="va">area_log</span> <span class="op">+</span> <span class="va">population_log</span>, 
    <span class="co"># Use a simple linear hyperplane</span>
    kernel <span class="op">=</span> <span class="st">"linear"</span>, 
    <span class="co"># Scale the data</span>
    scale <span class="op">=</span> <span class="cn">TRUE</span>,
    <span class="co"># Cost value for observations</span>
    <span class="co"># crossing the hyperplane</span>
    cost <span class="op">=</span> <span class="fl">10</span>
  <span class="op">)</span>

<span class="co"># Predict the values for the testing dataset</span>
<span class="va">ru_svm_prediction</span> <span class="op">&lt;-</span>
  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
    <span class="va">ru_svm_model</span>,
    <span class="va">ru_svm_data_testing</span> <span class="op">%&gt;%</span> 
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">area_log</span>, <span class="va">population_log</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># Add predicted values to the table</span>
<span class="va">ru_svm_data_testing</span> <span class="op">&lt;-</span>
  <span class="va">ru_svm_data_testing</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>
    svm_predicted_ru <span class="op">=</span> <span class="va">ru_svm_prediction</span>
  <span class="op">)</span>

<span class="co"># Confusion matrix</span>
<span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>
  <span class="va">ru_svm_data_testing</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">svm_predicted_ru</span><span class="op">)</span>,
  <span class="va">ru_svm_data_testing</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">rural_urban</span><span class="op">)</span>,
  mode <span class="op">=</span> <span class="st">"everything"</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction rural urban
##      rural    66    27
##      urban    60   264
##                                           
##                Accuracy : 0.7914          
##                  95% CI : (0.7492, 0.8294)
##     No Information Rate : 0.6978          
##     P-Value [Acc &gt; NIR] : 1.104e-05       
##                                           
##                   Kappa : 0.4656          
##                                           
##  Mcnemar's Test P-Value : 0.0006019       
##                                           
##             Sensitivity : 0.5238          
##             Specificity : 0.9072          
##          Pos Pred Value : 0.7097          
##          Neg Pred Value : 0.8148          
##               Precision : 0.7097          
##                  Recall : 0.5238          
##                      F1 : 0.6027          
##              Prevalence : 0.3022          
##          Detection Rate : 0.1583          
##    Detection Prevalence : 0.2230          
##       Balanced Accuracy : 0.7155          
##                                           
##        'Positive' Class : rural           
## </code></pre>
<p>As a third more complex example, we can explore how to build a model for rural - urban classification using the presence of the five different types of dwelling as input variables. The confusion matrix below clearly illustrates that a simple linear SVM is not adequate to construct such a model.</p>
<div class="sourceCode" id="cb297"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Data for SVM model</span>
<span class="va">ru_dwellings_data</span> <span class="op">&lt;-</span>
  <span class="va">liec_shire_2011OAC_RU</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>
    <span class="va">OA11CD</span>, <span class="va">rural_urban</span>, <span class="va">Total_Dwellings</span>,
    <span class="va">u086</span><span class="op">:</span><span class="va">u090</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># scale across</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span> 
      <span class="va">u086</span><span class="op">:</span><span class="va">u090</span>,
      <span class="va">scale</span>
      <span class="co">#function(x){ (x / Total_Dwellings) * 100 }</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>
    scaled_detached <span class="op">=</span> <span class="va">u086</span>,
    scaled_semidetached <span class="op">=</span> <span class="va">u087</span>,
    scaled_terraced <span class="op">=</span> <span class="va">u088</span>,
    scaled_flats <span class="op">=</span> <span class="va">u089</span>,    
    scaled_carava_tmp <span class="op">=</span> <span class="va">u090</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Total_Dwellings</span><span class="op">)</span>

<span class="co"># Training set</span>
<span class="va">ru_dwellings_data_trainig</span> <span class="op">&lt;-</span>
  <span class="va">ru_dwellings_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">slice_sample</span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>

<span class="co"># Testing set</span>
<span class="va">ru_dwellings_data_testing</span> <span class="op">&lt;-</span> 
  <span class="va">ru_dwellings_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">anti_join</span><span class="op">(</span><span class="va">ru_dwellings_data_trainig</span><span class="op">)</span>

<span class="co"># Build the model</span>
<span class="va">ru_dwellings_svm_model</span> <span class="op">&lt;-</span> 
  <span class="va">ru_dwellings_data_trainig</span> <span class="op">%$%</span>
  <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span><span class="op">(</span>
    <span class="va">rural_urban</span> <span class="op">~</span> 
      <span class="va">scaled_detached</span> <span class="op">+</span> <span class="va">scaled_semidetached</span> <span class="op">+</span> <span class="va">scaled_terraced</span> <span class="op">+</span> 
      <span class="va">scaled_flats</span> <span class="op">+</span> <span class="va">scaled_carava_tmp</span>, 
    <span class="co"># Use a simple linear hyperplane</span>
    kernel <span class="op">=</span> <span class="st">"linear"</span>,
    <span class="co"># Cost value for observations</span>
    <span class="co"># crossing the hyperplane</span>
    cost <span class="op">=</span> <span class="fl">10</span>
  <span class="op">)</span>

<span class="co"># Predict the values for the testing dataset</span>
<span class="va">ru_dwellings_svm_prediction</span> <span class="op">&lt;-</span>
  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
    <span class="va">ru_dwellings_svm_model</span>,
    <span class="va">ru_dwellings_data_testing</span> <span class="op">%&gt;%</span> 
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">scaled_detached</span><span class="op">:</span><span class="va">scaled_carava_tmp</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># Add predicted values to the table</span>
<span class="va">ru_dwellings_data_testing</span> <span class="op">&lt;-</span>
  <span class="va">ru_dwellings_data_testing</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>
    dwellings_svm_predicted_ru <span class="op">=</span> <span class="va">ru_dwellings_svm_prediction</span>
  <span class="op">)</span>

<span class="co"># Confusion matrix</span>
<span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>
  <span class="va">ru_dwellings_data_testing</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">dwellings_svm_predicted_ru</span><span class="op">)</span>,
  <span class="va">ru_dwellings_data_testing</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">rural_urban</span><span class="op">)</span>,
  mode <span class="op">=</span> <span class="st">"everything"</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction rural urban
##      rural     0     0
##      urban   123   294
##                                           
##                Accuracy : 0.705           
##                  95% CI : (0.6587, 0.7484)
##     No Information Rate : 0.705           
##     P-Value [Acc &gt; NIR] : 0.5243          
##                                           
##                   Kappa : 0               
##                                           
##  Mcnemar's Test P-Value : &lt;2e-16          
##                                           
##             Sensitivity : 0.000           
##             Specificity : 1.000           
##          Pos Pred Value :   NaN           
##          Neg Pred Value : 0.705           
##               Precision :    NA           
##                  Recall : 0.000           
##                      F1 :    NA           
##              Prevalence : 0.295           
##          Detection Rate : 0.000           
##    Detection Prevalence : 0.000           
##       Balanced Accuracy : 0.500           
##                                           
##        'Positive' Class : rural           
## </code></pre>
</div>
<div id="kernels" class="section level3" number="9.2.4">
<h3>
<span class="header-section-number">9.2.4</span> Kernels<a class="anchor" aria-label="anchor" href="#kernels"><i class="fas fa-link"></i></a>
</h3>
<p>Instead of relying on simple linear hyperplanes, we can use the <em>“kernel trick”</em> to project the data into a higher-dimensional space, which might allow groups to be (more easily) linearly separable.</p>
<div class="sourceCode" id="cb299"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Build a second model</span>
<span class="co"># using a radial kernel</span>
<span class="va">ru_dwellings_svm_radial_model</span> <span class="op">&lt;-</span> 
  <span class="va">ru_dwellings_data_trainig</span> <span class="op">%$%</span>
  <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span><span class="op">(</span>
    <span class="va">rural_urban</span> <span class="op">~</span> 
      <span class="va">scaled_detached</span> <span class="op">+</span> <span class="va">scaled_semidetached</span> <span class="op">+</span> <span class="va">scaled_terraced</span> <span class="op">+</span> 
      <span class="va">scaled_flats</span> <span class="op">+</span> <span class="va">scaled_carava_tmp</span>, 
    <span class="co"># Use a radial kernel</span>
    kernel <span class="op">=</span> <span class="st">"radial"</span>,
    <span class="co"># Cost value for observations</span>
    <span class="co"># crossing the hyperplane</span>
    cost <span class="op">=</span> <span class="fl">10</span>
  <span class="op">)</span>

<span class="co"># Predict the values for the testing dataset</span>
<span class="va">ru_svm_dwellings_radial_prediction</span> <span class="op">&lt;-</span>
  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>
    <span class="va">ru_dwellings_svm_radial_model</span>,
    <span class="va">ru_dwellings_data_testing</span> <span class="op">%&gt;%</span> 
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">scaled_detached</span><span class="op">:</span><span class="va">scaled_carava_tmp</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># Add predicted values to the table</span>
<span class="va">ru_dwellings_data_testing</span> <span class="op">&lt;-</span>
  <span class="va">ru_dwellings_data_testing</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>
    dwellings_radial_predicted_ru <span class="op">=</span> <span class="va">ru_svm_dwellings_radial_prediction</span>
  <span class="op">)</span>

<span class="co"># Confusion matrix</span>
<span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>
  <span class="va">ru_dwellings_data_testing</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">dwellings_radial_predicted_ru</span><span class="op">)</span>,
  <span class="va">ru_dwellings_data_testing</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">rural_urban</span><span class="op">)</span>,
  mode <span class="op">=</span> <span class="st">"everything"</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction rural urban
##      rural    37    19
##      urban    86   275
##                                           
##                Accuracy : 0.7482          
##                  95% CI : (0.7037, 0.7892)
##     No Information Rate : 0.705           
##     P-Value [Acc &gt; NIR] : 0.02874         
##                                           
##                   Kappa : 0.2806          
##                                           
##  Mcnemar's Test P-Value : 1.187e-10       
##                                           
##             Sensitivity : 0.30081         
##             Specificity : 0.93537         
##          Pos Pred Value : 0.66071         
##          Neg Pred Value : 0.76177         
##               Precision : 0.66071         
##                  Recall : 0.30081         
##                      F1 : 0.41341         
##              Prevalence : 0.29496         
##          Detection Rate : 0.08873         
##    Detection Prevalence : 0.13429         
##       Balanced Accuracy : 0.61809         
##                                           
##        'Positive' Class : rural           
## </code></pre>
</div>
<div id="artificial-neural-network" class="section level3" number="9.2.5">
<h3>
<span class="header-section-number">9.2.5</span> Artificial neural network<a class="anchor" aria-label="anchor" href="#artificial-neural-network"><i class="fas fa-link"></i></a>
</h3>
<p>Finally, we can explore the construction of an ANN for the same input and output variables seen in the previous example, and compare which one of the two approaches produces better results. The example below creates a multi-layer ANN, using two hidden layers, with five and two nodes, respectively.</p>
<div class="sourceCode" id="cb301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load library for ANNs</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bips-hb/neuralnet">neuralnet</a></span><span class="op">)</span>

<span class="co"># Build a third model</span>
<span class="co"># using an ANN</span>
<span class="va">ru_dwellings_nnet_model</span> <span class="op">&lt;-</span>
  <span class="fu">neuralnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html">neuralnet</a></span><span class="op">(</span>
    <span class="va">rural_urban</span> <span class="op">~</span> 
      <span class="va">scaled_detached</span> <span class="op">+</span> <span class="va">scaled_semidetached</span> <span class="op">+</span> <span class="va">scaled_terraced</span> <span class="op">+</span> 
      <span class="va">scaled_flats</span> <span class="op">+</span> <span class="va">scaled_carava_tmp</span>,
    data <span class="op">=</span> <span class="va">ru_dwellings_data_trainig</span>,
    <span class="co"># Use 2 hidden layers</span>
    hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span>,
    <span class="co"># Max num of steps for training</span>
    stepmax <span class="op">=</span> <span class="fl">1000000</span>
  <span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ru_dwellings_nnet_model</span> <span class="op">%&gt;%</span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>rep <span class="op">=</span> <span class="st">"best"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="400_SupervisedLearning_files/figure-html/unnamed-chunk-17-1.png" width="672"></div>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Predict the values for the testing dataset</span>
<span class="va">ru_dwellings_nnet_prediction</span> <span class="op">&lt;-</span>
  <span class="fu">neuralnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/neuralnet/man/compute.html">compute</a></span><span class="op">(</span>
    <span class="va">ru_dwellings_nnet_model</span>,
    <span class="va">ru_dwellings_data_testing</span> <span class="op">%&gt;%</span> 
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">scaled_detached</span><span class="op">:</span><span class="va">scaled_carava_tmp</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># Derive predicted categories</span>
<span class="va">ru_dwellings_nnet_predicted_categories</span> <span class="op">&lt;-</span>
  <span class="co"># from the prediction object</span>
  <span class="va">ru_dwellings_nnet_prediction</span> <span class="op">%$%</span>
  <span class="co"># extract the result</span>
  <span class="co"># which is a matrix of probabilities</span>
  <span class="co"># for each object and category</span>
  <span class="va">net.result</span> <span class="op">%&gt;%</span>
  <span class="co"># select the column (thus the category)</span>
  <span class="co"># with higher probability</span>
  <span class="va">max.col</span> <span class="op">%&gt;%</span>
  <span class="co"># recode columns values as</span>
  <span class="co"># rural or urban</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span>
    `1` <span class="op">=</span> <span class="st">"rural"</span>,
    `2` <span class="op">=</span> <span class="st">"urban"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rural"</span>, <span class="st">"urban"</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># Add predicted values to the table</span>
<span class="va">ru_dwellings_data_testing</span> <span class="op">&lt;-</span>
  <span class="va">ru_dwellings_data_testing</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span><span class="op">(</span>
    dwellings_nnet_predicted_ru <span class="op">=</span> 
      <span class="va">ru_dwellings_nnet_predicted_categories</span>
  <span class="op">)</span>

<span class="co"># Confusion matrix</span>
<span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span>
  <span class="va">ru_dwellings_data_testing</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">dwellings_nnet_predicted_ru</span><span class="op">)</span>,
  <span class="va">ru_dwellings_data_testing</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">rural_urban</span><span class="op">)</span>,
  mode <span class="op">=</span> <span class="st">"everything"</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction rural urban
##      rural    52    29
##      urban    71   265
##                                           
##                Accuracy : 0.7602          
##                  95% CI : (0.7162, 0.8004)
##     No Information Rate : 0.705           
##     P-Value [Acc &gt; NIR] : 0.007021        
##                                           
##                   Kappa : 0.3599          
##                                           
##  Mcnemar's Test P-Value : 4.132e-05       
##                                           
##             Sensitivity : 0.4228          
##             Specificity : 0.9014          
##          Pos Pred Value : 0.6420          
##          Neg Pred Value : 0.7887          
##               Precision : 0.6420          
##                  Recall : 0.4228          
##                      F1 : 0.5098          
##              Prevalence : 0.2950          
##          Detection Rate : 0.1247          
##    Detection Prevalence : 0.1942          
##       Balanced Accuracy : 0.6621          
##                                           
##        'Positive' Class : rural           
## </code></pre>
</div>
</div>
<div id="exercise-404.1" class="section level2" number="9.3">
<h2>
<span class="header-section-number">9.3</span> Exercise 404.1<a class="anchor" aria-label="anchor" href="#exercise-404.1"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Question 404.1.1:</strong> Create an SVM model capable of classifying areas in Leicester and Leicestershire as rural or urban based on the series of variables that relate to <em>“Economic Activity”</em> among the 167 initial variables used to create the <a href="https://maps.cdrc.ac.uk/#/geodemographics/oac11/default/BTTTFFT/12/-1.1233/52.6454/">2011 Output Area Classification</a> (<a href="http://josis.net/index.php/josis/article/view/232/150">Gale <em>et al.</em>, 2016</a>).</p>
<p><strong>Question 404.1.2:</strong> Create an ANN using the same input and output values used in Question 404.1.1.</p>
<p><strong>Question 404.1.3:</strong> Assess which one of the two models preforms a better classification.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="regression-analysis.html"><span class="header-section-number">8</span> Regression analysis</a></div>
<div class="next"><a href="unsupervised-machine-learning.html"><span class="header-section-number">10</span> Unsupervised machine learning</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#supervised-machine-learning"><span class="header-section-number">9</span> Supervised machine learning</a></li>
<li>
<a class="nav-link" href="#introduction-2"><span class="header-section-number">9.1</span> Introduction</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#artificial-neural-networks"><span class="header-section-number">9.1.1</span> Artificial neural networks</a></li>
<li><a class="nav-link" href="#support-vector-machines"><span class="header-section-number">9.1.2</span> Support vector machines</a></li>
<li><a class="nav-link" href="#confusion-matrices"><span class="header-section-number">9.1.3</span> Confusion matrices</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#examples"><span class="header-section-number">9.2</span> Examples</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#data"><span class="header-section-number">9.2.1</span> Data</a></li>
<li><a class="nav-link" href="#logistic-regression"><span class="header-section-number">9.2.2</span> Logistic regression</a></li>
<li><a class="nav-link" href="#support-vector-machines-1"><span class="header-section-number">9.2.3</span> Support vector machines</a></li>
<li><a class="nav-link" href="#kernels"><span class="header-section-number">9.2.4</span> Kernels</a></li>
<li><a class="nav-link" href="#artificial-neural-network"><span class="header-section-number">9.2.5</span> Artificial neural network</a></li>
</ul>
</li>
<li><a class="nav-link" href="#exercise-404.1"><span class="header-section-number">9.3</span> Exercise 404.1</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/sdesabbata/r-for-geographic-data-science/blob/master/400_SupervisedLearning.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/sdesabbata/r-for-geographic-data-science/edit/master/400_SupervisedLearning.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Geographic Data Science</strong>" was written by Stefano De Sabbata. It was last built on 2021-09-15.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
